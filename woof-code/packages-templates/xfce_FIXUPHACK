cat << EOF > pinstall.sh
echo xfce4-session > etc/windowmanager
echo false > etc/desktop_app
echo "XDG_CURRENT_DESKTOP=XFCE" >> etc/environment
EOF

cat << EOF > etc/xdg/menus/xfce-applications.menu
<!DOCTYPE Menu PUBLIC "-//freedesktop//DTD Menu 1.0//EN"
  "http://www.freedesktop.org/standards/menu-spec/1.0/menu.dtd">

<Menu>
    <Name>Xfce</Name>

    <DefaultAppDirs/>
    <DefaultDirectoryDirs/>

    <Include>
        <Category>X-Xfce-Toplevel</Category>
    </Include>

    <Layout>
        <Merge type="menus"/>
        <Separator/>
        <Filename>xfce4-about.desktop</Filename>
        <Filename>xfce4-session-logout.desktop</Filename>
    </Layout>

    <Menu>
        <Name>Desktop</Name>
        <Directory>Puppy-Desktop.directory</Directory>
        <Include>
            <Or>
                <Category>X-Desktop</Category>
                <Category>X-Desktop-appearance</Category>
                <Category>DesktopSettings</Category>
                <Category>X-Desktop-settings</Category>
                <Category>X-DesktopCountry</Category>
                <Category>Accessibility</Category>
                <Category>X-Desktop-windows</Category>
                <Category>X-Desktop-sleep</Category>
                <Category>Screensaver</Category>
                <Category>X-Desktop-applet</Category>
                <Category>X-DesktopApplets</Category>
                <Category>Clock</Category>
            </Or>
        </Include>
    </Menu>

    <Menu>
        <Name>System</Name>
        <Directory>Puppy-System.directory</Directory>
        <Include>
            <Or>
                <Category>X-System</Category>
                <Category>System</Category>
                <Category>HardwareSettings</Category>
                <Category>Core</Category>
                <Category>X-System-process</Category>
                <Category>Monitor</Category>
                <Category>X-SystemSchedule</Category>
                <Category>X-System-memory</Category>
                <Category>X-SystemMemory</Category>
                <Category>X-System-print</Category>
                <Category>X-System-storage</Category>
                <Category>X-System-security</Category>
                <Category>Security</Category>
            </Or>
        </Include>
        <Exclude>
            <Or>
                <Filename>xfce4-session-logout.desktop</Filename>
                <Filename>thunar.desktop</Filename>
                <Filename>thunar-bulk-rename.desktop</Filename>
            </Or>
        </Exclude>
    </Menu>

    <Menu>
        <Name>Setup</Name>
        <Directory>Puppy-Setup.directory</Directory>
        <Include>
            <Or>
                <Category>X-Setup</Category>
                <Category>X-Setup-puppy</Category>
                <Category>X-SetupEntry</Category>
                <Category>PackageManager</Category>
                <Category>X-Setup-wizard</Category>
                <Category>X-SetupWizard</Category>
                <Category>X-Setup-installation</Category>
                <Category>X-SetupUtility</Category>
            </Or>
        </Include>
    </Menu>

    <Menu>
        <Name>Utility</Name>
        <Directory>Puppy-Utility.directory</Directory>
        <Include>
            <Or>
                <Category>X-Utility</Category>
                <Category>Utility</Category>
                <Category>Viewer</Category>
                <Category>Electronics</Category>
                <Category>Emulator</Category>
                <Category>Engineering</Category>
                <Category>X-Utility-development</Category>
                <Category>Development</Category>
                <Category>Building</Category>
                <Category>Debugger</Category>
                <Category>IDE</Category>
                <Category>Profiling</Category>
                <Category>ProjectManagement</Category>
                <Category>RevisionControl</Category>
                <Category>Translation</Category>
                <Category>GUIDesigner</Category>
                <Category>X-Utility-package</Category>
                <Category>Archiving</Category>
                <Category>Compression</Category>
                <Category>X-Utility-shell</Category>
                <Category>TerminalEmulator</Category>
                <Category>Shell</Category>
                <Category>X-Utility-help</Category>
                <Category>Documentation</Category>
            </Or>
        </Include>
        <Exclude>
            <Or>
                <Filename>xfce4-file-manager.desktop</Filename>
                <Filename>xfce4-terminal-emulator.desktop</Filename>
                <Filename>xfce4-about.desktop</Filename>
                <Filename>xfce4-run.desktop</Filename>
                <Filename>thunar.desktop</Filename>
                <Filename>thunar-bulk-rename.desktop</Filename>
            </Or>
        </Exclude>
    </Menu>

    <Menu>
        <Name>Filesystem</Name>
        <Directory>Puppy-Filesystem.directory</Directory>
        <Include>
            <Or>
                <Category>X-Filesystem</Category>
                <Category>FileSystem</Category>
                <Category>Filesystem</Category>
                <Category>FileTools</Category>
                <Category>X-Filesystem-filemanager</Category>
                <Category>FileManager</Category>
                <Category>X-Filesystem-mount</Category>
                <Category>X-FilesystemMount</Category>
                <Category>X-Filesystem-find</Category>
                <Category>X-FilesystemFind</Category>
                <Category>X-Filesystem-storage</Category>
                <Category>X-FilesystemUtility</Category>
            </Or>
        </Include>
    </Menu>

    <Menu>
        <Name>Graphic</Name>
        <Directory>Puppy-Graphic.directory</Directory>
        <Include>
            <Or>
                <Category>X-Graphic</Category>
                <Category>2DGraphics</Category>
                <Category>3DGraphics</Category>
                <Category>X-Graphic-paint</Category>
                <Category>RasterGraphics</Category>
                <Category>X-Graphic-draw</Category>
                <Category>VectorGraphics</Category>
                <Category>X-Graphic-flow</Category>
                <Category>Chart</Category>
                <Category>FlowChart</Category>
                <Category>Presentation</Category>
                <Category>X-Graphic-viewer</Category>
                <Category>Viewer</Category>
                <Category>X-Graphic-camera</Category>
                <Category>Photography</Category>
                <Category>X-Graphic-scanner</Category>
                <Category>Scanning</Category>
                <Category>OCR</Category>
                <Category>X-Graphic-print</Category>
                <Category>X-Graphic-utility</Category>
                <Category>X-GraphicUtility</Category>
            </Or>
        </Include>
    </Menu>

    <Menu>
        <Name>Document</Name>
        <Directory>Puppy-Document.directory</Directory>
        <Include>
            <Or>
                <Category>X-Document</Category>
                <Category>X-Document-layout</Category>
                <Category>WordProcessor</Category>
                <Category>WebDevelopment</Category>
                <Category>Publishing</Category>
                <Category>X-Document-catalog</Category>
                <Category>Dictionary</Category>
                <Category>X-Document-edit</Category>
                <Category>TextEditor</Category>
                <Category>X-Document-viewer</Category>
                <Category>Viewer</Category>
                <Category>X-Document-utility</Category>
                <Category>X-DocumentUtility</Category>
            </Or>
        </Include>
    </Menu>

    <Menu>
        <Name>Business</Name>
        <Directory>Puppy-Business.directory</Directory>
        <Include>
            <Or>
                <Category>X-Business</Category>
                <Category>X-Calculate</Category>
                <Category>X-Business-spreadsheet</Category>
                <Category>Spreadsheet</Category>
                <Category>X-Business-planner</Category>
                <Category>ProjectManagement</Category>
                <Category>X-Business-finance</Category>
                <Category>Finance</Category>
                <Category>X-Business-calc</Category>
                <Category>Calculator</Category>
                <Category>X-CalculateUtility</Category>
            </Or>
        </Include>
    </Menu>

    <Menu>
        <Name>Personal</Name>
        <Directory>Puppy-Personal.directory</Directory>
        <Include>
            <Or>
                <Category>X-Personal</Category>
                <Category>X-Personal-database</Category>
                <Category>ContactManagement</Category>
                <Category>X-Personal-date</Category>
                <Category>Calendar</Category>
                <Category>X-Personal-organizer</Category>
                <Category>PDA</Category>
                <Category>X-Personal-security</Category>
                <Category>X-Personal-timing</Category>
                <Category>X-PersonalUtility</Category>
                <Category>X-Personal-education</Category>
                <Category>Languages</Category>
                <Category>Science</Category>
                <Category>ArtificialIntelligence</Category>
                <Category>Astronomy</Category>
                <Category>Biology</Category>
                <Category>Chemistry</Category>
                <Category>ComputerScience</Category>
                <Category>DataVisualization</Category>
                <Category>Economy</Category>
                <Category>Electricity</Category>
                <Category>Geography</Category>
                <Category>Geology</Category>
                <Category>Geoscience</Category>
                <Category>History</Category>
                <Category>ImageProcessing</Category>
                <Category>Literature</Category>
                <Category>Math</Category>
                <Category>NumericalAnalysis</Category>
                <Category>MedicalSoftware</Category>
                <Category>Physics</Category>
                <Category>Robotics</Category>
                <Category>Sports</Category>
                <Category>ParallelComputing</Category>
            </Or>
        </Include>
    </Menu>

    <Menu>
        <Name>Network</Name>
        <Directory>Puppy-Network.directory</Directory>
        <Include>
            <Or>
                <Category>X-Network</Category>
                <Category>Network</Category>
                <Category>X-Network-firewall</Category>
                <Category>X-Network-phone</Category>
                <Category>Dialup</Category>
                <Category>X-Network-connect</Category>
                <Category>HamRadio</Category>
                <Category>RemoteAccess</Category>
                <Category>X-Network-transfer</Category>
                <Category>X-Network-utility</Category>
            </Or>
        </Include>
        <Exclude>
            <Or>
                <Filename>xfce4-mail-reader.desktop</Filename>
                <Filename>xfce4-web-browser.desktop</Filename>
            </Or>
        </Exclude>
    </Menu>

    <Menu>
        <Name>Internet</Name>
        <Directory>Puppy-Internet.directory</Directory>
        <Include>
            <Or>
                <Category>X-Internet</Category>
                <Category>X-Internet-browser</Category>
                <Category>WebBrowser</Category>
                <Category>X-Internet-chat</Category>
                <Category>InstantMessaging</Category>
                <Category>Chat</Category>
                <Category>VideoConference</Category>
                <Category>X-Internet-mailnews</Category>
                <Category>Email</Category>
                <Category>News</Category>
                <Category>X-Internet-transfer</Category>
                <Category>Telephony</Category>
                <Category>IRCClient</Category>
                <Category>FileTransfer</Category>
                <Category>P2P</Category>
                <Category>X-Internet-login</Category>
                <Category>X-Internet-block</Category>
                <Category>X-Internet-utility</Category>
            </Or>
        </Include>
        <Exclude>
            <Or>
                <Filename>xfce4-mail-reader.desktop</Filename>
                <Filename>xfce4-web-browser.desktop</Filename>
            </Or>
        </Exclude>
    </Menu>

    <Menu>
        <Name>Multimedia</Name>
        <Directory>Puppy-Multimedia.directory</Directory>
        <Include>
            <Or>
                <Category>X-Multimedia</Category>
                <Category>Recorder</Category>
                <Category>X-Multimedia-mediaplayer</Category>
                <Category>Player</Category>
                <Category>X-Multimedia-audiovideo</Category>
                <Category>AudioVideo</Category>
                <Category>AudioVideoEditing</Category>
                <Category>Tuner</Category>
                <Category>X-Multimedia-sound</Category>
                <Category>Music</Category>
                <Category>Audio</Category>
                <Category>Midi</Category>
                <Category>Mixer</Category>
                <Category>Sequencer</Category>
                <Category>X-Multimedia-video</Category>
                <Category>Video</Category>
                <Category>TV</Category>
                <Category>X-Multimedia-optical</Category>
                <Category>DiskBurning</Category>
                <Category>X-Multimedia-utility</Category>
            </Or>
        </Include>
    </Menu>

    <Menu>
        <Name>Fun</Name>
        <Directory>Puppy-Fun.directory</Directory>
        <Include>
            <Or>
                <Category>X-Fun</Category>
                <Category>Game</Category>
                <Category>Amusement</Category>
                <Category>BlocksGame</Category>
                <Category>KidsGame</Category>
                <Category>Simulation</Category>
                <Category>SportsGame</Category>
                <Category>X-Fun-adventure</Category>
                <Category>ActionGame</Category>
                <Category>AdventureGame</Category>
                <Category>RolePlaying</Category>
                <Category>X-Fun-boardgame</Category>
                <Category>BoardGame</Category>
                <Category>X-Fun-cardgame</Category>
                <Category>CardGame</Category>
                <Category>X-Fun-puzzle</Category>
                <Category>StrategyGame</Category>
                <Category>LogicGame</Category>
                <Category>X-Fun-shooter</Category>
                <Category>X-Fun-arcade</Category>
                <Category>ArcadeGame</Category>
            </Or>
        </Include>
    </Menu>

    <DefaultMergeDirs/>

</Menu>
EOF

cat << EOF > pinstall.sh
echo xfce4-session > etc/windowmanager
echo none > etc/desktop_app
sed 's~^Icon=\(.*48\.png\)$~Icon=/usr/local/lib/X11/pixmaps/\1~' -i usr/share/desktop-directories/Puppy-*.directory
EOF